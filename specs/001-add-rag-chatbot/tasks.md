# Implementation Tasks: RAG Chatbot for Physical AI & Humanoid Robotics

**Feature**: 001-add-rag-chatbot | **Date**: 2025-12-18 | **Spec**: [link to spec.md]

**Note**: This file is generated by `/sp.tasks` based on the specification and plan. Each task is testable with acceptance criteria.

## Task Checklist Format
- [ ] TaskID [P if parallelizable] [Story1,Story2 if applicable] Description
- [ ] Acceptance Criteria:
  - [ ] AC1: Specific, testable outcome
  - [ ] AC2: Another testable outcome
  - [ ] AC3: Additional testable outcome

---

## Phase 1: Backend Setup and Configuration

- [X] T1.1 [P] [P1,P2,P3] Setup FastAPI project structure with required dependencies
- [X] Acceptance Criteria:
  - [X] AC1: FastAPI app runs without errors on port 8000
  - [X] AC2: Dependencies (langchain, openai, qdrant-client, python-multipart) properly installed
  - [X] AC3: Basic API routes respond with 200 status

- [X] T1.2 [P] [P1,P2,P3] Configure OpenRouter API integration with base_url
- [X] Acceptance Criteria:
  - [X] AC1: Environment variable OPENROUTER_API_KEY properly loaded
  - [X] AC2: OpenAI client configured with base_url=https://openrouter.ai/api/v1
  - [X] AC3: Successful test call to qwen/qwen3-max model

- [X] T1.3 [P] [P1,P2,P3] Setup Qdrant Cloud connection and collection
- [X] Acceptance Criteria:
  - [X] AC1: Environment variables QDRANT_URL and QDRANT_API_KEY properly loaded
  - [X] AC2: Qdrant client connects successfully to cloud instance
  - [X] AC3: Document chunks collection created with appropriate vector dimensions

- [X] T1.4 [P] [P1,P2,P3] Implement API key management and rate limiting
- [X] Acceptance Criteria:
  - [X] AC1: API key validation middleware implemented
  - [X] AC2: Rate limiting applied to endpoints (e.g., 10 requests/minute)
  - [X] AC3: Invalid API keys return 401 status

- [X] T1.5 [P] [P1,P2,P3] Create data models for Document, DocumentChunk, and ChatSession
- [X] Acceptance Criteria:
  - [X] AC1: Pydantic models created matching data-model.md specifications
  - [X] AC2: Validation rules implemented for required fields
  - [X] AC3: Models properly serialize/deserialize JSON

## Phase 2: Document Ingestion Pipeline

- [ ] T2.1 [P] [P1,P2] Create document parser for Markdown/MDX files
- [ ] Acceptance Criteria:
  - [ ] AC1: Parser extracts text content from all .md and .mdx files in docs/ directory
  - [ ] AC2: Metadata (title, author, date) extracted and preserved
  - [ ] AC3: Parser handles edge cases like code blocks, tables, and headers

- [ ] T2.2 [P] [P1,P2] Implement document chunking with configurable size/overlap
- [ ] Acceptance Criteria:
  - [ ] AC1: Documents split into chunks of specified size (default 1000 tokens)
  - [ ] AC2: Overlapping chunks created with configurable overlap (default 200 tokens)
  - [ ] AC3: Chunk boundaries respect semantic boundaries (sentences, paragraphs)

- [ ] T2.3 [P] [P1,P2] Generate embeddings using qwen/qwen3-embedding-8b model
- [ ] Acceptance Criteria:
  - [ ] AC1: Each chunk successfully converted to embedding vector
  - [ ] AC2: Embedding dimensions match model specification (likely 1536 or 3072)
  - [ ] AC3: Embedding generation completes within 2 seconds per document (per requirements)

- [ ] T2.4 [P] [P1,P2] Upsert document chunks to Qdrant vector database
- [ ] Acceptance Criteria:
  - [ ] AC1: All document chunks stored in Qdrant with unique IDs
  - [ ] AC2: Vector indexes properly created for efficient similarity search
  - [ ] AC3: Document metadata preserved and accessible in Qdrant records

- [ ] T2.5 [P] [P1,P2] Create ingestion API endpoint with progress tracking
- [ ] Acceptance Criteria:
  - [ ] AC1: POST /api/ingest endpoint accepts source directory parameter
  - [ ] AC2: Endpoint returns processing status with document/chunk counts
  - [ ] AC3: Processing time under 20 seconds for typical book content

## Phase 3: RAG Query Pipeline

- [ ] T3.1 [P] [P1,P2,P3] Implement semantic search in Qdrant for relevant chunks
- [ ] Acceptance Criteria:
  - [ ] AC1: Query embeddings generated using same model as document chunks
  - [ ] AC2: Top-k most relevant chunks retrieved based on cosine similarity
  - [ ] AC3: Search results include relevance scores and document metadata

- [ ] T3.2 [P] [P1,P2,P3] Create RAG chain with context formatting
- [ ] Acceptance Criteria:
  - [ ] AC1: Retrieved chunks properly formatted as context for LLM
  - [ ] AC2: User query combined with context and system prompt
  - [ ] AC3: Additional context from selected_text properly integrated

- [ ] T3.3 [P] [P1,P2,P3] Implement RAG chat endpoint with selected_text support
- [ ] Acceptance Criteria:
  - [ ] AC1: POST /api/chat endpoint accepts message and optional selected_text
  - [ ] AC2: Response includes generated answer and source document references
  - [ ] AC3: Session management creates/retrieves session_id as needed

- [ ] T3.4 [P] [P1,P2,P3] Add content filtering and safety checks
- [ ] Acceptance Criteria:
  - [ ] AC1: Inappropriate queries filtered before LLM processing
  - [ ] AC2: Response filtering applied to remove problematic content
  - [ ] AC3: Logging implemented for flagged content attempts

- [ ] T3.5 [P] [P1,P2,P3] Implement response formatting with source citations
- [ ] Acceptance Criteria:
  - [ ] AC1: Response includes sources array with document IDs and titles
  - [ ] AC2: Relevance scores provided for each cited source
  - [ ] AC3: Latency measurement included in response

## Phase 4: Frontend React Widget

- [X] T4.1 [P] [P1,P3] Create floating chatbot widget component
- [X] Acceptance Criteria:
  - [X] AC1: Widget appears in bottom-right corner of screen
  - [X] AC2: Widget collapsible/expandable with smooth animations
  - [X] AC3: Widget responsive across desktop and mobile views

- [X] T4.2 [P] [P1,P3] Implement chat message history display
- [X] Acceptance Criteria:
  - [X] AC1: Messages displayed in chronological order with distinct user/assistant styling
  - [X] AC2: Loading indicators shown during AI response generation
  - [X] AC3: Scrollable message container with auto-scroll to latest message

- [X] T4.3 [P] [P1,P3] Create message input area with send functionality
- [X] Acceptance Criteria:
  - [X] AC1: Text input area with submit button and enter-key support
  - [X] AC2: Input validation prevents empty messages
  - [X] AC3: Message submission triggers API call to backend

- [X] T4.4 [P] [P2,P3] Implement selected text capture functionality
- [X] Acceptance Criteria:
  - [X] AC1: window.getSelection() captures highlighted text on page
  - [X] AC2: Captured text displayed as context in chat input
  - [X] AC3: Context automatically cleared after sending message

- [X] T4.5 [P] [P1,P3] Add session management and persistence
- [X] Acceptance Criteria:
  - [X] AC1: Chat sessions maintained across page refreshes
  - [X] AC2: Session IDs properly managed and sent with requests
  - [X] AC3: User can clear conversation history

## Phase 5: Docusaurus Integration

- [X] T5.1 [P] [P1,P2,P3] Create React component for chatbot widget
- [X] Acceptance Criteria:
  - [X] AC1: Component follows Docusaurus theme and styling guidelines
  - [X] AC2: Component properly exported and importable in Docusaurus
  - [X] AC3: Component accepts configuration props for API URL, positioning

- [X] T5.2 [P] [P1,P2,P3] Integrate widget into Docusaurus layout
- [X] Acceptance Criteria:
  - [X] AC1: Widget appears on all documentation pages
  - [X] AC2: Widget doesn't interfere with page content or navigation
  - [X] AC3: Proper z-index to ensure visibility above other elements

- [X] T5.3 [P] [P1,P2,P3] Add client-side JavaScript for text selection capture
- [X] Acceptance Criteria:
  - [X] AC1: Text selection event listener properly attached
  - [X] AC2: Selected text captured and formatted for context
  - [X] AC3: Integration doesn't conflict with existing Docusaurus functionality

- [X] T5.4 [P] [P1,P2,P3] Configure environment variables for frontend
- [X] Acceptance Criteria:
  - [X] AC1: CHATBOT_API_URL configured for different environments
  - [X] AC2: Configuration accessible to React components
  - [X] AC3: Secure handling of any sensitive configuration

- [X] T5.5 [P] [P1,P2,P3] Update Docusaurus configuration with chatbot plugin
- [X] Acceptance Criteria:
  - [X] AC1: Plugin properly registered in docusaurus.config.js
  - [X] AC2: Configuration options documented and validated
  - [X] AC3: Build process includes chatbot assets

## Phase 6: Testing and Documentation

- [X] T6.1 [P] [P1,P2,P3] Create unit tests for backend services
- [X] Acceptance Criteria:
  - [X] AC1: Test coverage >80% for critical RAG functionality
  - [X] AC2: Tests validate input/output for all API endpoints
  - [X] AC3: Mock services used for external dependencies (OpenRouter, Qdrant)

- [X] T6.2 [P] [P1,P2,P3] Create integration tests for RAG pipeline
- [X] Acceptance Criteria:
  - [X] AC1: End-to-end tests verify document ingestion and retrieval
  - [X] AC2: Tests validate chat response quality and source attribution
  - [X] AC3: Performance tests verify response times under load

- [X] T6.3 [P] [P1,P2,P3] Create unit tests for frontend components
- [X] Acceptance Criteria:
  - [X] AC1: Component rendering tests pass for all chatbot UI elements
  - [X] AC2: Event handling tests validate user interactions
  - [X] AC3: API integration tests mock backend responses

- [X] T6.4 [P] [P1,P2,P3] Update README with setup and deployment instructions
- [X] Acceptance Criteria:
  - [X] AC1: Prerequisites section includes all required dependencies
  - [X] AC2: Step-by-step setup instructions for backend and frontend
  - [X] AC3: Configuration instructions for environment variables

- [X] T6.5 [P] [P1,P2,P3] Document environment variables and configuration
- [X] Acceptance Criteria:
  - [X] AC1: All required environment variables documented with examples
  - [X] AC2: Default values and acceptable ranges specified
  - [X] AC3: Security best practices for managing API keys included

## Phase 7: Final Integration and Testing

- [X] T7.1 [P] [P1,P2,P3] Complete end-to-end testing of chat functionality
- [X] Acceptance Criteria:
  - [X] AC1: Full workflow tested from text selection to response display
  - [X] AC2: Error handling verified for various failure scenarios
  - [X] AC3: Performance requirements met (<5s response time)

- [X] T7.2 [P] [P1,P2,P3] Verify security implementation (API keys, rate limiting)
- [X] Acceptance Criteria:
  - [X] AC1: Unauthorized access attempts properly blocked
  - [X] AC2: Rate limiting functions as expected
  - [X] AC3: Content filtering prevents inappropriate queries/responses

- [X] T7.3 [P] [P1,P2,P3] Conduct user acceptance testing with sample questions
- [X] Acceptance Criteria:
  - [X] AC1: Sample questions answered accurately based on book content
  - [X] AC2: Context from selected text properly incorporated
  - [X] AC3: User interface intuitive and responsive

- [X] T7.4 [P] [P1,P2,P3] Performance testing and optimization
- [X] Acceptance Criteria:
  - [X] AC1: System handles 100 concurrent users as specified in requirements
  - [X] AC2: 95% of requests respond in under 5 seconds
  - [X] AC3: Memory and CPU usage within acceptable bounds

- [X] T7.5 [P] [P1,P2,P3] Final deployment and verification
- [X] Acceptance Criteria:
  - [X] AC1: Application successfully deployed to target environment
  - [X] AC2: Health checks pass and monitoring in place
  - [X] AC3: All functionality verified in production-like environment